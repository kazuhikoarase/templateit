<project basedir="../.." default="all">

  <property name="src" location="src" />
  <property name="build" location="build" />
  <property name="templateit" location="${build}/templateit" />
  <property name="dist" location="${build}/dist" />
  <property name="test" location="${build}/test" />

  <target name="all" depends="dist,test" />

  <target name="init">
    <tstamp>
      <format property="timestamp" pattern="yyyyMMddHHmm" />
    </tstamp>
    <property name="version" value="v${timestamp}" />
    <property name="target.name" value="templateit.${version}" />
    <mkdir dir="${build}" />
  </target>

  <target name="clean">
    <delete dir="${build}" />
  </target>

  <target name="compile" depends="init">
    <mkdir dir="${build}/java" />
    <javac
      srcdir="${src}/main/java"
      destdir="${build}/java"
      encoding="UTF-8"
      target="1.6"
      source="1.6"
      debug="true"
      includeantruntime="false"
    />
    <echo file="${build}/java/version" message="${version}" />
  </target>

  <target name="dist" depends="compile">

    <mkdir dir="${templateit}" />
    <property name="templateit.jar" value="templateit.jar" />

    <jar jarfile="${templateit}/${templateit.jar}">
      <zipfileset dir="${build}/java">
        <include name="**/*" />
      </zipfileset>
      <manifest>
        <attribute name="Main-Class" value="com.d_project.templateit.Main" />
      </manifest>
    </jar>

    <mkdir dir="${dist}" />
    <zip destfile="${dist}/${target.name}.zip">
      <zipfileset dir="${src}/main/assets" prefix="${target.name}">
        <include name="*" />
      </zipfileset>
      <zipfileset dir="${templateit}" prefix="${target.name}">
        <include name="${templateit.jar}" />
      </zipfileset>
    </zip>

  </target>

  <target name="test" depends="dist">

    <property name="template-project" location="${test}/MyTemplate" />
  	<mkdir dir="${template-project}" />
    <copy todir="${template-project}">
      <fileset dir="${src}/test/MyTemplate" />
    </copy>
    <unzip dest="${template-project}" src="${dist}/${target.name}.zip" />
    <rename src="${template-project}/${target.name}"
      dest="${template-project}/templateit" />
<!--
    <ant antfile="${template-project}/${target.name}/build.xml"
      inheritall="false" />
    <java jar="${template-project}/${target.name}/dist/">
      <arg value="test-proj" />
      <arg value="aa.bb.cc" />
    	</java>
-->
  	
  </target>

</project>
